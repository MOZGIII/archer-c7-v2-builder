version: v1.0
name: Build image
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
execution_time_limit:
  hours: 16
blocks:
  - name: Build
    task:
      secrets:
        - name: archer-c7-v2-builds-push
      jobs:
        - name: Run
          commands:
            - df -h
            - free -m
            - nproc
            - checkout
            - git submodule update --init
            - ls -alh
            - .semaphore/prepare-free-space.sh
            - export BUILD_CFG_LOW_SPACE=true
            - env
            - bin/build
            - df -h
            - .semaphore/upload.sh "build/bin"
